{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "TOOLS — Install Homebrew (macOS)",
      "type": "shell",
      "command": "/usr/bin/env bash -lc '/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"'",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    },
    {
      "label": "TOOLS — Install Essentia (Homebrew)",
      "type": "shell",
      "command": "/usr/bin/env bash -lc '${workspaceFolder}/.venv/bin/python ${workspaceFolder}/scripts/install_essentia.py'",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "TOOLS — Install Essentia CLI (vendor/manual)",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python ${workspaceFolder}/scripts/install_essentia_cli.py",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    },
    {
      "label": "TOOLS — Check audio env",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python -m djlib.cli analyze-audio --check-env",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "STEP 2 — Analyze audio (cache)",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python -m djlib.cli analyze-audio",
      "dependsOn": [
        "STEP 0 — Setup: create venv & install deps",
        "TOOLS — Check audio env"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "TOOLS — Generate preview CSV",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python ${workspaceFolder}/scripts/report_preview.py",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "STEP 0 — Setup: create venv & install deps",
      "type": "shell",
      "command": "/usr/bin/env bash -lc 'python3 -m venv .venv && source .venv/bin/activate && pip install -U pip && pip install -r requirements.txt && pip install -e .'",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "TOOLS — Install fpcalc (Homebrew)",
      "type": "shell",
      "command": "/usr/bin/env bash -lc 'if command -v brew >/dev/null; then (brew list chromaprint >/dev/null 2>&1 || brew install chromaprint); else echo \"❌ Brak Homebrew\" && exit 1; fi'",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "TOOLS — Install fpcalc (Download vendor)",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python ${workspaceFolder}/scripts/install_fpcalc.py",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "STEP 1 — Scan INBOX_UNSORTED",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python -m djlib.cli scan",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "TOOLS — Detect taxonomy from filesystem",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python -m djlib.cli detect-taxonomy",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "STEP 3 — Auto-decide (rules.yml) — only empty",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python -m djlib.cli auto-decide --only-empty",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "STEP 3 (alt) — Auto-decide (rules → set/suggest)",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python ${workspaceFolder}/scripts/auto_decide_rules.py",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "STEP 4 — Apply decisions (dry-run)",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python -m djlib.cli apply --dry-run",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "STEP 5 — Apply decisions",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python -m djlib.cli apply",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "TOOLS — Undo last moves",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python -m djlib.cli undo",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "TOOLS — Report duplicates",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python -m djlib.cli dupes",
      "dependsOn": "STEP 0 — Setup: create venv & install deps",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "TESTS — run",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/pytest -q",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "TESTS — coverage",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/pytest --cov=djlib --cov-report=term-missing",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "TESTS — run",
      "type": "shell",
      "command": "/Users/sztuka/Projects/dj-library-manager/.venv/bin/pytest -q",
      "args": []
    },
    {
      "label": "TESTS — run",
      "type": "shell",
      "command": "/Users/sztuka/Projects/dj-library-manager/.venv/bin/pytest -q",
      "args": []
    },
    {
      "label": "TESTS — run",
      "type": "shell",
      "command": "/Users/sztuka/Projects/dj-library-manager/.venv/bin/pytest -q",
      "args": []
    },
    {
      "label": "TESTS — run",
      "type": "shell",
      "command": "/Users/sztuka/Projects/dj-library-manager/.venv/bin/pytest -q",
      "args": []
    },
    {
      "label": "TESTS — run",
      "type": "shell",
      "command": "/Users/sztuka/Projects/dj-library-manager/.venv/bin/pytest -q",
      "args": []
    },
    {
      "label": "TESTS — run",
      "type": "shell",
      "command": "/Users/sztuka/Projects/dj-library-manager/.venv/bin/pytest -q",
      "args": []
    }
  ]
}
